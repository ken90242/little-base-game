<html>
<head>
<title>進制轉換Quiz</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel=stylesheet type="text/css" href="lib/css/bootstrap.min.css">
<script type="text/javascript" src="lib/js/jquery.js"></script>
<style type="text/css">
	body{
		font-family: 'Clear Sans', 'Helvetica Neue', Arial, sans-serif;
	}
	h1,#thematic{
		font-size:80px;
	}
	.multi{
		font-size: 40px;
	}
	#thematic{
		line-height:200px;
		text-align:center;
	}
	#bg{
		background-color: rgb(237, 197, 63);
		color:white;
		height:25%;
		border-radius:20px;
	}
	#lookans{
		margin:2px;
	}
	.option{
		display:inline-block;
		background-color:rgb(238, 228, 218);
		color:rgb(119, 110, 101);
		font-size: 80px;
		border-radius:20px;
		margin-right: 50px;
		margin-left: 50px;
		margin-bottom: 20px;
		width: 254px;
	}
	#count{
		margin-right:5%;
	}
	@media screen and (min-width: 200px) and (max-width: 700px) {
	    h1,#thematic{
	    	font-size:40px;
	    }
	    #thematic{
			line-height:120px;
			text-align:center;
		}
		.multi{
			font-size: 20px;
		}
		#bg{
			background-color: rgb(237, 197, 63);
			color:white;
			height:120px;
			border-radius:20px;
		}
		.option{
			display:inline-block;
			text-align: center;
			background-color:rgb(238, 228, 218);
			color:rgb(119, 110, 101);
			font-size: 40px;
			border-radius:20px;
			margin-top: 5px;
			margin-right: 5px;
			margin-left: 5px;
			margin-bottom: 10px;
			width: 130px;
			height: 75px;
		}
		.option:hover{
			display:inline-block;
			text-align: center;
			background-color:rgb(238, 228, 218);
			color:rgb(119, 110, 101);
			font-size: 40px;
			border-radius:20px;
			margin-top: 5px;
			margin-right: 5px;
			margin-left: 5px;
			margin-bottom: 10px;
			width: 130px;
			height: 75px;
		}
	}
</style>
<script>
	$(function(){
		$("<audio id=\"correct_audio\" style='display:none;'><source src='assets/audio/correct-trim.mp3'/></audio>").appendTo('body')
		$("#count").text(0);
		$("#f_count").text(0);
		chg_thematic();
		eventRegister()
		
	});

	function eventRegister() {
		$("#lookans").on('click', function(){
			alert($("#answer").val());
		});
		$("#surprise").on('click', function(){
			var countdown = 60
			$('#lookans').remove()
			$('#surprise').remove()
			alert('請於一分鐘內連續答對90題')
			count_down(countdown)
			$('h1').css({'color':'#FE2E64','font-size':'110px'})
			setTimeout(function(){
				alert('Time\'s up!')
				location.reload()
			},countdown*1000)
		})
		$('.option').on('click', function(){
			if($("#answer").val() == $(this).val()){
    			$('#correct_audio')[0].play()
    			chg_thematic();
    			$('#bg').css({"background-color":"rgb(237, 197, 63)"});
    			var cur_count = parseInt($("#count").text(),10);
				$("#count").text(++cur_count);
    		}else{
    			$('#bg').css({"background-color":"red"});
				var fcur_count = parseInt($("#f_count").text(),10);
				$("#f_count").text(++fcur_count);
    		}
		})
	}

	function count_down(num) {
		$('h1').text(num)
		if(num===0) return
		setTimeout(function(){
			count_down(--num)
		},1000)
	}

	function gen_format(type,q) {
		var res = ""
		var pre = "(" + q + ")"
		var pre_under = ""
		var post = "( ? )"
		var post_under = ""
		switch(type) {
			case "base2to10":
				pre_under = "2"
				post_under = "10"
				break
			case "base10to2":
				pre_under = "10"
				post_under = "2"
				break
			case "base10to16":
				pre_under = "10"
				post_under = "16"
				break
			case "sqrt10":
				pre = q
				post = "2^?"
				break
			case "pow10":
				pre = q
				post = "?"
				break
		}
		res = pre+"<span class=\"multi\">"+pre_under+"</span>="+post+"<span class=\"multi\">"+post_under+"</span>"
		return res
	}

	function chg_thematic(){		
		$.get('generate_qa',function(data,res){
			let q = data.ques,
				opt = data.ans,
				pos = data.correct_position,
				type = data.type,
			    a = opt[pos]

			$("#thematic").html(gen_format(type,q));
			$("#answer").val(a);

			for(let i=0;i<4;i++) {
				$('.option')[i].value = opt[i]
				$('.option')[i].textContent = opt[i]
			}
		})
	}
	function removeA(arr) {
	    var what, a = arguments, L = a.length, ax;
	    while (L > 1 && arr.length) {
	        what = a[--L];
	        while ((ax= arr.indexOf(what)) !== -1) {
	            arr.splice(ax, 1);
	        }
	    }
	    return arr;
	}
	function fix_mobile_hover() {
	    var el = this;
	    var par = el.parentNode;
	    var next = el.nextSibling;
	    par.removeChild(el);
	    par.insertBefore(el, next);
	}
</script>
</head>
<body style="background-color:rgb(250, 248, 239);font-family: 'Clear Sans', 'Helvetica Neue', Arial, sans-serif;">
<div class="container">
	<div style="text-align:center;">
		<h1 style="font-family: 'Clear Sans', 'Helvetica Neue', Arial, sans-serif;color:rgb(119, 110, 101);">Quick Test</h1>
		<span style="font-family: '微軟正黑體';font-size:20px;color:rgb(119, 110, 101);">累計題數:</span>
		<span id="count"></span>
		<span style="font-family: '微軟正黑體';font-size:20px;color:rgb(119, 110, 101);">答錯次數:</span>
		<span id="f_count"></span>

	</div>
	<div style="padding:2%;text-align:center">
		<div id="bg">
			<p id="thematic"></p>
		</div>
		<button id="surprise" class="btn btn-danger">挑戰mode</button>
		<button id="lookans" class="btn btn-info">查看答案</button>
	</div>
	<div style="padding:1%;">
		<div style="text-align:center"><button id="1" class="option btn" value="" ontouchend="this.onclick=fix_mobile_hover"></button><button id="2" class="option btn" value="" ontouchend="this.onclick=fix_mobile_hover"></button></div>
		<div style="text-align:center"><button id="3" class="option btn" value="" ontouchend="this.onclick=fix_mobile_hover"></button><button id="4" class="option btn" value="" ontouchend="this.onclick=fix_mobile_hover"></button></div>
		<input id="answer" type="hidden"/>
	</div>
</div>
</body>
</html>